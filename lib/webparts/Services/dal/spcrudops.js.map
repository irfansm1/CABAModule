{"version":3,"sources":["webparts/Services/dal/spcrudops.ts"],"names":[],"mappings":"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","file":"webparts/Services/dal/spcrudops.js","sourcesContent":["\nimport { ICabaModuleProps } from \"../interface/ICabaModuleProps\";\n//import {  Web } from \"@pnp/sp\";\nimport { LogLevel, Logger, Web, sp, ItemAddResult } from 'sp-pnp-js';\n\n//import { ConsoleListener, Logger, LogLevel } from \"@pnp/logging\";\n\nexport interface ISPCRUDOPS {\n    getData(listName: string, columnsToRetrieve: string, columnsToExpand: string, filters: string\n        , orderby: { column: string, isAscending: boolean }, props: ICabaModuleProps): Promise<any>;\n    getRootData(listName: string, columnsToRetrieve: string, columnsToExpand: string, filters: string\n        , orderby: { column: string, isAscending: boolean }, props: ICabaModuleProps): Promise<any>;\n    insertData(listName: string, data: any, props: ICabaModuleProps): Promise<any>;\n     updateData(listName: string, itemId: number, data: any, props: ICabaModuleProps): Promise<any>;\n     deleteData(listName: string, itemId: number, props: ICabaModuleProps): Promise<any>;\n    // getListInfo(listName: string, props: IVendorBlockReleaseDevProps): Promise<any>;\n    batchInsert(listName: string, data: any, props: ICabaModuleProps): Promise<any>;\n    //currentProfile(props: IEximTravelBlockProps): Promise<any>;\n    getGroupUsers(UserId:any, props: ICabaModuleProps): Promise<any>;\n    currentUserInfo(props: ICabaModuleProps): Promise<any>;\n    // batchUpdate(listName: string, data: any, props: IVendorBlockReleaseDevProps): Promise<any>;\n    // batchDelete(listName: string, data: any, props: IVendorBlockReleaseDevProps): Promise<any>;\n    // uploadFile(folderServerRelativeUrl: string, file: File, props: IVendorBlockReleaseDevProps): Promise<any>;\n    // deleteFile(fileServerRelativeUrl: string, props: IVendorBlockReleaseDevProps): Promise<any>;\n}\n\nexport default async function SPCRUDOPS(): Promise<ISPCRUDOPS> {\n    const getData = async (listName: string, columnsToRetrieve: string, columnsToExpand: string, filters: string, orderby: { column: string, isAscending: boolean }, props: ICabaModuleProps) => {\n        let web = new Web(props.currentSPContext.pageContext.web.absoluteUrl);\n        const items: any[] = await web.lists.getByTitle(listName).items.select(columnsToRetrieve).expand(columnsToExpand).filter(filters).orderBy(orderby.column, orderby.isAscending).getAll();\n        return items;\n    };\n    const getRootData = async (listName: string, columnsToRetrieve: string, columnsToExpand: string, filters: string, orderby: { column: string, isAscending: boolean }, props: ICabaModuleProps) => {\n        let url = window.location.origin;\n        let web = new Web(url);\n        const items: any[] = await web.lists.getByTitle(listName).items.select(columnsToRetrieve).expand(columnsToExpand).filter(filters).orderBy(orderby.column, orderby.isAscending).getAll();\n        return items;\n    };\n    const insertData = async (listName: string, data: any, props: ICabaModuleProps) => {\n        let web = new Web(props.currentSPContext.pageContext.web.absoluteUrl);\n        return await web.lists.getByTitle(listName).items.add(data).then(result => {\n            return result;\n        });\n    };\n    const batchInsert = async (listName: string, data: any, props: ICabaModuleProps) => {\n        let web = new Web(props.currentSPContext.pageContext.web.absoluteUrl);\n        let list = web.lists.getByTitle(listName);\n        const entityTypeFullName = await list.getListItemEntityTypeFullName();\n        let batch = web.createBatch();\n\n        for (let d = 0; d < data.length; d++) {\n            list.items.inBatch(batch).add(data[d], entityTypeFullName).then(b => {\n                console.log(b);\n            });\n        }\n\n        return await batch.execute();\n    };\n    const updateData = async (listName: string, itemId: number, data: any, props: ICabaModuleProps) => {\n        let web = new Web(props.currentSPContext.pageContext.web.absoluteUrl);\n        return await web.lists.getByTitle(listName).items.getById(itemId).update(data).then(result => {\n            return result;\n        });\n    };\n\n    // const currentProfile = async (props: IEximTravelBlockProps) => {\n    //     return await sp.profiles.myProperties.get().then(async(response)=>{\n    //         return await sp.web.currentUser.get().then(async(response)=>{\n    //             console.log(response);\n    //         return response;\n    //       });\n    //      });\n    // };  \n    \n    const currentUserInfo = async (props: ICabaModuleProps) => {\n            return await sp.web.currentUser.get().then(async(response)=>{\n                return await getGroupUsers(response.Id,props).then(async(groupsresponse)=>{\n                    response.ishr=groupsresponse.filter(function(x){return x.Title=='HR';}).length>0;\n                    response.istraveldesk=groupsresponse.filter(function(x){return x.Title=='TravelDesk';}).length>0;\n                    response.istraveladmin=groupsresponse.filter(function(x){return x.Title=='TICE_Admin';}).length>0; \n                    return response;        \n                })\n          });\n    }; \n\n    const getGroupUsers = async (UserId:any,props: ICabaModuleProps) => {\n      return await sp.web.siteUsers.getById(UserId).groups.get().then(groups => {\n        return groups;\n      });\n    };\n    // const getGroupUsers = async (groupId: number, props: IEximTravelBlockProps) => {\n    //     let web = new Web(props.currentSPContext.pageContext.web.absoluteUrl+ \"/_api/web/siteusers\");\n    //     const items: any = await web.siteGroups.getById(groupId);\n    //     return items;\n    // };\n\n    const deleteData = async (listName: string, itemId: number, props: ICabaModuleProps) => {        \n        let web = new Web(props.currentSPContext.pageContext.web.absoluteUrl);\n        return await web.lists.getByTitle(listName).items.getById(itemId).delete().then(result => {\n            return result;\n        });\n    };\n\n    // const getListInfo = async (listName: string, props: IVendorBlockReleaseDevProps) => {\n    //     let web = Web(props.currentSPContext.pageContext.web.absoluteUrl);\n    //     const list = await web.lists.getByTitle(listName);\n    //     const listInfo = await list.select(\"Id,Title\")();\n\n    //     return listInfo;\n    // };\n\n\n\n    // const batchUpdate = async (listName: string, data: any, props: IVendorBlockReleaseDevProps) => {\n    //     let web = Web(props.currentSPContext.pageContext.web.absoluteUrl);\n    //     let list = web.lists.getByTitle(listName);\n    //     const entityTypeFullName = await list.getListItemEntityTypeFullName();\n    //     let batch = web.createBatch();\n\n    //     for (let d = 0; d < data.length; d++) {\n    //         list.items.getById(data[d].Id).inBatch(batch).update(data[d], entityTypeFullName).then(b => {\n    //             console.log(b);\n    //         });\n    //     }\n\n    //     return await batch.execute();\n    // };\n\n    // const batchDelete = async (listName: string, data: any, props: IVendorBlockReleaseDevProps) => {\n    //     let web = Web(props.currentSPContext.pageContext.web.absoluteUrl);\n    //     let list = web.lists.getByTitle(listName);\n    //     const entityTypeFullName = await list.getListItemEntityTypeFullName();\n    //     let batch = web.createBatch();\n\n    //     for (let d = 0; d < data.length; d++) {\n    //         list.items.getById(data[d].Id).inBatch(batch).delete().then(b => {\n    //             console.log(b);\n    //         });\n    //     }\n\n    //     return await batch.execute();\n    // };\n\n    // const uploadFile = async (folderServerRelativeUrl: string, file: File, props: IVendorBlockReleaseDevProps) => {\n    //     Logger.subscribe(new ConsoleListener());\n    //     Logger.activeLogLevel = LogLevel.Verbose;\n\n    //     let web = Web(props.currentSPContext.pageContext.web.absoluteUrl);\n    //     var ticks = ((new Date().getTime() * 10000) + 621355968000000000);\n    //     return await web.getFolderByServerRelativeUrl(folderServerRelativeUrl).files.addChunked(ticks.toString() + \"_\" + file.name, file, data => {\n    //         Logger.log({ data: data, level: LogLevel.Verbose, message: \"progress\" });\n    //     }, true);\n    // };\n\n    // const deleteFile = async (fileServerRelativeUrl: string, props: IVendorBlockReleaseDevProps) => {\n    //     Logger.subscribe(new ConsoleListener());\n    //     Logger.activeLogLevel = LogLevel.Verbose;\n\n    //     let web = Web(props.currentSPContext.pageContext.web.absoluteUrl);\n\n    //     return await web.getFileByServerRelativeUrl(fileServerRelativeUrl).delete().then(result => {\n    //         return result;\n    //     });\n    // };\n\n    return {\n        getData\n        , insertData\n        , getRootData\n        ,batchInsert\n        ,updateData\n        ,getGroupUsers\n       // ,currentProfile,\n        ,currentUserInfo\n        ,     deleteData,\n        //     getListInfo,\n\n        //     batchUpdate,\n        //     batchDelete,\n        //     uploadFile,\n        //     deleteFile\n    };\n}"],"sourceRoot":"../../../../src"}